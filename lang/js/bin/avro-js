#!/usr/bin/env node

var fs = require('fs');
var compiler = require('../lib/compiler.js');

var what = process.argv[2];
var inputPath = process.argv[3];
var outPath = process.argv[4];
if (!what || !inputPath || !outPath) {
  console.log('usage: avro-js <schema|proto> <input> <outdir>');
} else {
  console.log('Using Avro', what, 'JSON file at', inputPath);
  console.log('Writing output to', outPath);
  var input = JSON.parse(fs.readFileSync(inputPath));
  var compiledParts = compiler.compileIndividually(what == 'proto' ? input.types : input);
  console.log('');
  for (part in compiledParts) {
    if (compiledParts.hasOwnProperty(part)) {
      var outFilename = outPath + '/' + part + '.js';
      console.log('*', outFilename);
      fs.writeFileSync(outFilename, new Buffer(compiledParts[part]));
    }
  }
}
